function e(e,n){const s=[];let r=0;for(const o of n)o.start>r&&s.push(t(e.substring(r,o.start))),r=o.start+o.length,s.push(`<span class="${o.type}">${t(e.substring(o.start,r))}</span>`);return r<e.length&&s.push(t(e.substring(r))),s.join("")}function t(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(function(e){return t[e]}))}function n(e,{tokenizer:t,plugins:n=[a,l,u]}){return function(e,t){if("string"==typeof e){const t=document.querySelector(e);t&&(e=t)}if(!(e instanceof HTMLTextAreaElement))return void console.warn("[Cesh] Not a textarea");const n=e.parentElement;if(!n)return;const s=e,r=document.createElement("div");n.insertBefore(r,e),s.classList.add("cesh-textarea"),r.classList.add("cesh-editor"),n.style.position="relative",r.style.position="absolute";const o=[];for(const e of t){const t=e(s,r);t&&o.push(t)}return{destroy(){n.removeChild(r),s.classList.remove("cesh-textarea");for(const e of o)e()}}}(e,[i(t),o,s,r,...n])}function s(e,t){const n=()=>{t.style.width=`${e.offsetWidth}px`,t.style.height=`${e.offsetHeight}px`},s=new ResizeObserver(n);return s.observe(e),n(),()=>s.disconnect()}function r(e,t){const n=()=>{t.style.top=`${e.offsetTop}px`,t.style.left=`${e.offsetLeft}px`};n();const s=setInterval(n,100);return()=>clearInterval(s)}function o(e,t){const n=()=>{t.scrollLeft=e.scrollLeft,t.scrollTop=e.scrollTop};return e.addEventListener("scroll",n),()=>e.removeEventListener("scroll",n)}const i=t=>(n,s)=>{const r=()=>{let r=n.value,o=[];try{o=t(r)}catch(e){}"\n"===r[r.length-1]&&(r+=" "),s.innerHTML=e(r,o)};n.addEventListener("keyup",r),n.addEventListener("input",r);const o=()=>{"visible"===document.visibilityState&&r()};return document.addEventListener("visibilitychange",o),r(),()=>{n.removeEventListener("keyup",r),n.removeEventListener("input",r),document.removeEventListener("visibilitychange",o)}};function c(e,t){const n=e.lastIndexOf("\n",t-1);return n<0?0:n+1}function a(e){const t=t=>{if("Tab"===t.key){t.preventDefault();const n=e.selectionStart,s=e.selectionEnd,{value:r}=e,o=c(r,n);if(n===s)if(t.shiftKey){const t=/ {1,4}/y;t.lastIndex=o;const s=t.exec(r);if(s){const t=s[0].length;e.value=r.substring(0,o)+r.substring(o+t),e.selectionStart=n-t,e.selectionEnd=n-t}}else{const t=(n-o)%4,s=0===t?4:4-t;e.value=r.substring(0,n)+" ".repeat(s)+r.substring(n),e.selectionStart=n+s,e.selectionEnd=n+s}else{const i=r.substring(o,s);if(t.shiftKey){const t=/(^|\n)    /g,c=i.replace(t,(e=>"\n"===e[0]?"\n":"")),a=[...i.matchAll(t)].length;e.value=r.substring(0,o)+c+r.substring(s),e.selectionStart=n-4,e.selectionEnd=s-4*a}else{const t=i.replace(/\n/g,"\n    "),c=i.replace(/[^\n]/g,"").length+1;e.value=r.substring(0,o)+"    "+t+r.substring(s),e.selectionStart=n+4,e.selectionEnd=s+4*c}}}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}function l(e){const t=t=>{if("Enter"===t.key){const n=e.selectionStart,{value:s}=e,r=c(s,n),o=/ +/gy;o.lastIndex=r;const i=o.exec(s);if(i){t.preventDefault();const r=i[0].length;e.value=s.substring(0,n)+"\n"+" ".repeat(r)+s.substring(n),e.selectionStart=n+r+1,e.selectionEnd=n+r+1}}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}function u(e){const t=t=>{const n={"'":"'",'"':'"',"(":")","{":"}","[":"]"};if(n[t.key]){const s=e.selectionStart,r=e.selectionEnd;if(r-s>0){t.preventDefault();const{value:o}=e;e.value=o.substring(0,s)+t.key+o.substring(s,r)+n[t.key]+o.substring(r),e.selectionStart=s+1,e.selectionEnd=r+1}}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}function d(e,t){const n=[];for(let s=0;s<e.length;){let r;for(const[o,i]of Object.entries(t))if(i.lastIndex=s,r=i.exec(e)){const e=r[0].length;if(0===e)throw Error(o);n.push({type:o,start:s,length:e}),s+=e;break}r||s++}return n}function f(e){return d(e,{keyword:/\b(SELECT|DISTINCT|FILTER|FROM|LEFT|RIGHT|INNER|OUTER|FULL|JOIN|ON|WHERE|ORDER BY|OR|AND|IN|AS|OVER|PARTITION BY|UNBOUNDED|PRECEDING|FOLLOWING|FETCH|FIRST|NEXT|ROW|ROWS|ONLY|WINDOW|HAVING|LIMIT|OFFSET|EXPLAIN|CREATE|TEMP|TABLE|VIEW|INSERT INTO|VALUES|UPDATE|SET|DELETE|DROP|TRUNCATE|EXCEPT|INTERSECT|UNION ALL|UNION)\b/gy,number:/-?\d+(\.\d+)?/gy,name:/\w+|"[^"]*"/gy,string:/'[^']*'/gy,punctuation:/\*|,|\(|\)/gy})}function g(e){return d(e,{comment:/\/\*.*?\*\/|\/\/[^\n]*?\n/gsy,keyword:/\b(var|let|const|return|if|for|of|in|while|yield|function|async|await|null|undefined|import|export|as|from|assert|delete|typeof|instanceof|void|new|super|class|extends|constructor|get|set|static)\b/gy,number:/-?\d+(\.\d+)?([eE][+-]?\d+)?/gy,name:/#?\w+/gy,string:/'[^'\n]*'|"[^"\n]*"|`[^`]*`/gy,punctuation:/:|,|\(|\)|{|}|;/gy,regex:/\/[^\n]*?[^\\]\/[dgimsuvy]*/gy,operator:/\?\?=|\|\|=|&&=|\|=|\^=|&=|>>>=|>>=|<<=|\*\*=|%=|\/=|\*=|-=|\+=|===|==|=|!==|!=|!|>=|>|<=|<|%|\+\+|--|-|\+|\*\*|&&|\|\||&|\||\^|~|<<|>>>|>>|\?/gy})}function y(e){const t=d(e,{punctuation:/{{[-~]?|[-~]?}}|{%[-~]?|[-~]?%}/gy,keyword:/\b(for|in|endfor|if|endif|block|endblock|apply|endapply|autoescape|endautoescape|set|extends)\b/gy,operator:/(\b(b-and|b-xor|b-or|not|or|and|in|matches|starts with|ends with|has every|has some)\b)|\?:|\?|:|==|!=|<=>|<|>|>=|<=|\.\.|\+|-|~|\*|\/|\/\/|%|is|\*\*|\?\?|\||\[|\]\./gy,number:/-?\d+(\.\d+)?/gy,string:/'[^']*'|"[^"]*"/gy,comment:/{#.*?#}/gsy,name:/\w+/gy}),n=[];let s=!1;for(const r of t)if((s||"comment"===r.type)&&n.push(r),"punctuation"===r.type){const t=e.substring(r.start,r.start+2);"{{"===t||"{%"===t?(s=!0,n.push(r)):s=!1}return n}export{n as editor,l as enterPlugin,g as jsTokenizer,e as markup,u as quotesPlugin,f as sqlTokenizer,a as tabPlugin,y as twigTokenizer};
