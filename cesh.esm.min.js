function e(e,{tokenizer:t,plugins:i=[n,s,r]}={}){if("string"==typeof e){const t=document.querySelector(e);t&&(e=t)}if(!(e&&e instanceof HTMLTextAreaElement))return void console.warn("[Editor] Couldn't find element or element wasn't a textarea");const c=e.parentElement;if(!c)return void console.warn("[Editor] Element didn't have a parent");const l=e,a=document.createElement("div");a.classList.add("cesh-editor"),l.classList.add("cesh-textarea"),c.style.position="relative",c.insertBefore(a,e);const u=()=>{let e=l.value;const n=t?t(e):[];"\n"===e[e.length-1]&&(e+=" "),a.innerHTML=o(e,n),a.scrollTop=l.scrollTop},E=()=>{a.scrollLeft=l.scrollLeft,a.scrollTop=l.scrollTop};l.addEventListener("keyup",u),l.addEventListener("input",u),l.addEventListener("scroll",E);const d=()=>{a.style.width=`${l.offsetWidth}px`,a.style.height=`${l.offsetHeight}px`,a.style.position="absolute"},f=new ResizeObserver(d);f.observe(l),d(),u();const g=[];for(const e of i){const t=e(l);t&&g.push(t)}return{destroy(){c.removeChild(a),l.classList.remove("cesh-textarea"),l.removeEventListener("keyup",u),l.removeEventListener("input",u),l.removeEventListener("scroll",E),f.disconnect();for(const e of g)e()}}}function t(e,t){const n=e.lastIndexOf("\n",t-1);return n<0?0:n+1}function n(e){const n=n=>{if("Tab"===n.key){n.preventDefault();const s=e.selectionStart,{value:r}=e;if(n.shiftKey){const n=t(r,s);"    "===r.substring(n,n+4)&&(e.value=r.substring(0,n)+r.substring(n+4),e.selectionStart=s-4,e.selectionEnd=s-4)}else e.value=r.substring(0,s)+"    "+r.substring(s),e.selectionStart=s+4,e.selectionEnd=s+4}};return e.addEventListener("keydown",n),()=>e.removeEventListener("keydown",n)}function s(e){const n=n=>{if("Enter"===n.key){const s=e.selectionStart,{value:r}=e,o=t(r,s),i=/ +/gy;i.lastIndex=o;const c=i.exec(r);if(c){n.preventDefault();const t=c[0].length;e.value=r.substring(0,s)+"\n"+" ".repeat(t)+r.substring(s),e.selectionStart=s+t+1,e.selectionEnd=s+t+1}}};return e.addEventListener("keydown",n),()=>e.removeEventListener("keydown",n)}function r(e){const t=t=>{const n={"'":"'",'"':'"',"(":")","{":"}","[":"]"};if(n[t.key]){const s=e.selectionStart,r=e.selectionEnd;if(r-s>0){t.preventDefault();const{value:o}=e;e.value=o.substring(0,s)+t.key+o.substring(s,r)+n[t.key]+o.substring(r),e.selectionStart=s+1,e.selectionEnd=r+1}}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}function o(e,t){const n=[];let s=0;for(const r of t)r.start>s&&n.push(i(e.substring(s,r.start))),s=r.start+r.length,n.push(`<span class="${r.type}">${i(e.substring(r.start,s))}</span>`);return s<e.length&&n.push(i(e.substring(s))),n.join("")}function i(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(function(e){return t[e]}))}function c(e,t){const n=[];for(let s=0;s<e.length;){let r;for(const[o,i]of Object.entries(t))if(i.lastIndex=s,r=i.exec(e)){const e=r[0].length;n.push({type:o,start:s,length:e}),s+=e;break}r||s++}return n}function l(e){return c(e,{keyword:/\b(SELECT|DISTINCT|FILTER|FROM|LEFT|RIGHT|INNER|OUTER|FULL|JOIN|ON|WHERE|ORDER BY|OR|AND|IN|AS|OVER|PARTITION BY|UNBOUNDED|PRECEDING|FOLLOWING|FETCH|FIRST|NEXT|ROW|ROWS|ONLY|WINDOW|HAVING|LIMIT|OFFSET|EXPLAIN|CREATE|TEMP|TABLE|VIEW|INSERT INTO|VALUES|UPDATE|SET|DELETE|DROP|TRUNCATE|EXCEPT|INTERSECT|UNION ALL|UNION)\b/gy,number:/-?\d+(\.\d+)?/gy,name:/\w+|"[^"]*"/gy,string:/'[^']*'/gy,punctuation:/\*|,|\(|\)/gy})}function a(e){return c(e,{comment:/\/\*.*?\*\/|\/\/[^\n]*?\n/gsy,keyword:/\b(var|let|const|return|if|for|of|in|while|yield|function|async|await|null|undefined|import|export|as|from|assert|delete|typeof|instanceof)\b/gy,number:/-?\d+(\.\d+)?([eE][+-]?\d+)?/gy,name:/\w+/gy,string:/'[^']*'|"[^"]*"|`[^`]*`/gy,punctuation:/:|,|\(|\)|{|}|;/gy,regex:/\/[^\n]*[^\\]\//gy,operator:/\*=|\/=|\+=|-=|=|\+\+|--|&&|\|\|!|&|\||\*|\/|\+|-/gy})}export{e as editor,s as enterPlugin,a as jsTokenizer,o as markup,r as quotesPlugin,l as sqlTokenizer,n as tabPlugin};
