!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).cesh={})}(this,(function(e){"use strict";function t(e,t){const n=[];let s=0;for(const r of t)r.start>s&&n.push(e.substring(s,r.start)),s=r.start+r.length,n.push(`<span class="${r.type}">${e.substring(r.start,s)}</span>`);return s<e.length&&n.push(e.substring(s)),n.join("")}e.editor=function(e,{formatter:n}={}){if("string"==typeof e&&(e=document.querySelector(e)),!(e&&e instanceof HTMLTextAreaElement))return void console.warn("[Editor] Couldn't find element or element wasn't a textarea");const s=e.parentElement;if(!s)return void console.warn("[Editor] Element didn't have a parent");const r=e,o=document.createElement("div");o.classList.add("cesh-editor"),r.classList.add("cesh-textarea"),s.style.position="relative",s.insertBefore(o,e);const i=e=>{if("Tab"===e.key){e.preventDefault();const t=r.selectionStart,{value:n}=r;if(e.shiftKey){let e=n.lastIndexOf("\n",t-1);e<0?e=0:e++,"    "===n.substring(e,e+4)&&(r.value=n.substring(0,e)+n.substring(e+4),r.selectionStart=t-4,r.selectionEnd=t-4)}else r.value=n.substring(0,t)+"    "+n.substring(t),r.selectionStart=t+4,r.selectionEnd=t+4}else if("Enter"===e.key){const t=r.selectionStart,{value:n}=r;let s=n.lastIndexOf("\n",t-1);s<0?s=0:s++;const o=/ +/gy;o.lastIndex=s;const i=o.exec(n);if(i){e.preventDefault();const s=i[0].length;r.value=n.substring(0,t)+"\n"+" ".repeat(s)+n.substring(t),r.selectionStart=t+s+1,r.selectionEnd=t+s+1}}},l=()=>{let e=r.value;const s=n?n(e):[];"\n"===e[e.length-1]&&(e+=" "),o.innerHTML=t(e,s),o.scrollTop=r.scrollTop},a=()=>{o.scrollTop=r.scrollTop};r.addEventListener("keydown",i),r.addEventListener("keyup",l),r.addEventListener("input",l),r.addEventListener("scroll",a);const c=()=>{o.style.width=`${r.offsetWidth}px`,o.style.height=`${r.offsetHeight}px`},d=new ResizeObserver(c);return d.observe(r),c(),l(),{destroy(){s.removeChild(o),r.classList.remove("cesh-textarea"),r.removeEventListener("keydown",i),r.removeEventListener("keyup",l),r.removeEventListener("input",l),r.removeEventListener("scroll",a),d.disconnect()}}},e.markup=t,e.sqlTokenizer=function(e){const t={keyword:/SELECT|DISTINCT|FROM|LEFT|RIGHT|INNER|OUTER|FULL|JOIN|ON|WHERE|ORDER BY|AS|OVER|FETCH|FIRST|NEXT|ROW|ROWS|WINDOW|HAVING|LIMIT|OFFSET|INSERT INTO|VALUES|UPDATE|SET|DELETE/gy,number:/-?\d+(\.\d+)?/gy,name:/\w+|"\w*"/gy,string:/'\w*'/gy,punctuation:/\*|,|\(|\)/gy},n=[];for(let s=0;s<e.length;){let r;for(const[o,i]of Object.entries(t))if(i.lastIndex=s,r=i.exec(e)){const e=r[0].length;n.push({type:o,start:s,length:e}),s+=e;break}r||s++}return n}}));
